
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Build template and runtime resources for the Amazon EKS AMI">
      
      
      
      
        <link rel="prev" href="../overview/">
      
      
        <link rel="next" href="../al2023/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Amazon Linux 2 - Amazon EKS AMI</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#amazon-linux-2" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Amazon EKS AMI" class="md-header__button md-logo" aria-label="Amazon EKS AMI" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Amazon EKS AMI
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Amazon Linux 2
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/awslabs/amazon-eks-ami" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    awslabs/amazon-eks-ami
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Amazon EKS AMI" class="md-nav__button md-logo" aria-label="Amazon EKS AMI" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Amazon EKS AMI
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/awslabs/amazon-eks-ami" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    awslabs/amazon-eks-ami
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CHANGELOG/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Changelog
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Community
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Community
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CONTRIBUTING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contribution guidelines
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CODE_OF_CONDUCT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Code of Conduct
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Usage
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Usage
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Amazon Linux 2
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Amazon Linux 2
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#template-variables" class="md-nav__link">
    <span class="md-ellipsis">
      
        Template variables
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#container-image-caching" class="md-nav__link">
    <span class="md-ellipsis">
      
        Container Image Caching
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customizing-kubelet-config" class="md-nav__link">
    <span class="md-ellipsis">
      
        Customizing Kubelet Config
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customizing-containerd-config" class="md-nav__link">
    <span class="md-ellipsis">
      
        Customizing Containerd Config
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ephemeral-storage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ephemeral Storage
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ephemeral Storage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#raid-0-for-kubelet-and-containerd-raid0" class="md-nav__link">
    <span class="md-ellipsis">
      
        RAID-0 for Kubelet and Containerd (raid0)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mount-for-persistent-volumes-mount" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mount for Persistent Volumes (mount)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#experimental-raid-10-kubelet-and-containerd-raid10" class="md-nav__link">
    <span class="md-ellipsis">
      
        Experimental: RAID-10 Kubelet and Containerd (raid10)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#version-locked-packages" class="md-nav__link">
    <span class="md-ellipsis">
      
        Version-locked packages
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../al2023/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Amazon Linux 2023
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    nodeadm
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    nodeadm
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nodeadm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    API
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    API
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nodeadm/doc/api-concepts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Concepts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nodeadm/doc/api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nodeadm/doc/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nodeadm/doc/playground/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Playground
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#template-variables" class="md-nav__link">
    <span class="md-ellipsis">
      
        Template variables
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#container-image-caching" class="md-nav__link">
    <span class="md-ellipsis">
      
        Container Image Caching
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customizing-kubelet-config" class="md-nav__link">
    <span class="md-ellipsis">
      
        Customizing Kubelet Config
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customizing-containerd-config" class="md-nav__link">
    <span class="md-ellipsis">
      
        Customizing Containerd Config
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ephemeral-storage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ephemeral Storage
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ephemeral Storage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#raid-0-for-kubelet-and-containerd-raid0" class="md-nav__link">
    <span class="md-ellipsis">
      
        RAID-0 for Kubelet and Containerd (raid0)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mount-for-persistent-volumes-mount" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mount for Persistent Volumes (mount)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#experimental-raid-10-kubelet-and-containerd-raid10" class="md-nav__link">
    <span class="md-ellipsis">
      
        Experimental: RAID-10 Kubelet and Containerd (raid10)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#version-locked-packages" class="md-nav__link">
    <span class="md-ellipsis">
      
        Version-locked packages
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="amazon-linux-2">Amazon Linux 2</h1>
<blockquote>
<p>[!IMPORTANT]
Amazon EKS stopped publishing EKS-optimized Amazon Linux 2 (AL2) AMIs on November 26, 2025. AL2023 and Bottlerocket based AMIs for Amazon EKS are available for all supported Kubernetes versions including 1.33 and higher.</p>
</blockquote>
<h2 id="template-variables">Template variables</h2>
<!-- template-variable-table-boundary -->
<table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>additional_yum_repos</code></td>
<td></td>
</tr>
<tr>
<td><code>ami_component_description</code></td>
<td></td>
</tr>
<tr>
<td><code>ami_description</code></td>
<td></td>
</tr>
<tr>
<td><code>ami_name</code></td>
<td></td>
</tr>
<tr>
<td><code>ami_regions</code></td>
<td></td>
</tr>
<tr>
<td><code>ami_users</code></td>
<td></td>
</tr>
<tr>
<td><code>arch</code></td>
<td></td>
</tr>
<tr>
<td><code>associate_public_ip_address</code></td>
<td></td>
</tr>
<tr>
<td><code>aws_access_key_id</code></td>
<td></td>
</tr>
<tr>
<td><code>aws_region</code></td>
<td></td>
</tr>
<tr>
<td><code>aws_secret_access_key</code></td>
<td></td>
</tr>
<tr>
<td><code>aws_session_token</code></td>
<td></td>
</tr>
<tr>
<td><code>binary_bucket_name</code></td>
<td></td>
</tr>
<tr>
<td><code>binary_bucket_region</code></td>
<td></td>
</tr>
<tr>
<td><code>cache_container_images</code></td>
<td></td>
</tr>
<tr>
<td><code>cni_plugin_version</code></td>
<td></td>
</tr>
<tr>
<td><code>containerd_version</code></td>
<td></td>
</tr>
<tr>
<td><code>install_containerd_from_s3</code></td>
<td></td>
</tr>
<tr>
<td><code>creator</code></td>
<td></td>
</tr>
<tr>
<td><code>enable_accelerator</code></td>
<td>Either nvidia or neuron. Disabled by default. If enabled, launch_block_device_mappings_volume_size bust be 10 GiB or more</td>
</tr>
<tr>
<td><code>enable_efa</code></td>
<td>false by default. If enable_accelerator is set to neuron or nvidia, efa support is added even if enable_efa is false</td>
</tr>
<tr>
<td><code>docker_version</code></td>
<td>Docker is not installed on Kubernetes v1.25+</td>
</tr>
<tr>
<td><code>enable_fips</code></td>
<td>Install openssl and enable fips related kernel parameters</td>
</tr>
<tr>
<td><code>encrypted</code></td>
<td></td>
</tr>
<tr>
<td><code>iam_instance_profile</code></td>
<td>The name of an IAM instance profile to launch the EC2 instance with.</td>
</tr>
<tr>
<td><code>instance_type</code></td>
<td></td>
</tr>
<tr>
<td><code>kernel_version</code></td>
<td></td>
</tr>
<tr>
<td><code>kms_key_id</code></td>
<td></td>
</tr>
<tr>
<td><code>kubernetes_build_date</code></td>
<td></td>
</tr>
<tr>
<td><code>kubernetes_version</code></td>
<td></td>
</tr>
<tr>
<td><code>launch_block_device_mappings_volume_size</code></td>
<td></td>
</tr>
<tr>
<td><code>pause_container_version</code></td>
<td></td>
</tr>
<tr>
<td><code>pull_cni_from_github</code></td>
<td></td>
</tr>
<tr>
<td><code>remote_folder</code></td>
<td>Directory path for shell provisioner scripts on the builder instance</td>
</tr>
<tr>
<td><code>runc_version</code></td>
<td></td>
</tr>
<tr>
<td><code>security_group_id</code></td>
<td></td>
</tr>
<tr>
<td><code>source_ami_filter_name</code></td>
<td></td>
</tr>
<tr>
<td><code>source_ami_id</code></td>
<td></td>
</tr>
<tr>
<td><code>source_ami_owners</code></td>
<td></td>
</tr>
<tr>
<td><code>ssh_interface</code></td>
<td>If using <code>session_manager</code>, you need to specify a non-minimal ami as the minimal version does not have the SSM agent installed.</td>
</tr>
<tr>
<td><code>ssh_username</code></td>
<td></td>
</tr>
<tr>
<td><code>ssm_agent_version</code></td>
<td>Version of the SSM agent to install from the S3 bucket provided by the SSM agent project, such as <code>latest</code>. If empty, the latest version of the SSM agent available in the Amazon Linux core repositories will be installed.</td>
</tr>
<tr>
<td><code>subnet_id</code></td>
<td></td>
</tr>
<tr>
<td><code>temporary_security_group_source_cidrs</code></td>
<td></td>
</tr>
<tr>
<td><code>user_data_file</code></td>
<td>Path to a file that will be used for the user data when launching the instance.</td>
</tr>
<tr>
<td><code>volume_type</code></td>
<td></td>
</tr>
<tr>
<td><code>working_dir</code></td>
<td>Directory path for ephemeral resources on the builder instance</td>
</tr>
<tr>
<td><code>custom_endpoint_ec2</code></td>
<td></td>
</tr>
</tbody>
</table>
<!-- template-variable-table-boundary -->

<hr />
<h2 id="container-image-caching">Container Image Caching</h2>
<p>Optionally, some container images can be cached during the AMI build process in order to reduce the latency of the node getting to a <code>Ready</code> state when launched.</p>
<p>To turn on container image caching:</p>
<pre><code>cache_container_images=true make 1.23
</code></pre>
<p>When container image caching is enabled, the following images are cached:
 - 602401143452.dkr.ecr.<AWS_REGION>.amazonaws.com/eks/kube-proxy:<default and latest>-eksbuild.<BUILD_VERSION>
 - 602401143452.dkr.ecr.<AWS_REGION>.amazonaws.com/eks/kube-proxy:<default and latest>-minimal-eksbuild.<BUILD_VERSION>
 - 602401143452.dkr.ecr.<AWS_REGION>.amazonaws.com/amazon-k8s-cni-init:<default and latest>
 - 602401143452.dkr.ecr.<AWS_REGION>.amazonaws.com/amazon-k8s-cni:<default and latest></p>
<p>The account ID can be different depending on the region and partition you are building the AMI in. See <a href="https://docs.aws.amazon.com/eks/latest/userguide/add-ons-images.html">here</a> for more details.</p>
<p>Since the VPC CNI is not versioned with K8s itself, the latest version of the VPC CNI and the default version, based on the response from the EKS DescribeAddonVersions at the time of the AMI build, will be cached.</p>
<p>The images listed above are also tagged with each region in the partition the AMI is built in, since images are often built in one region and copied to others within the same partition. Images that are available to pull from an ECR FIPS endpoint are also tagged as such (i.e. <code>602401143452.dkr.ecr-fips.us-east-1.amazonaws.com/eks/pause:3.5</code>).</p>
<p>When listing images on a node, you'll notice a long list of images. However, most of these images are simply tagged in different ways with no storage overhead. Images cached in the AMI total around 1.0 GiB. In general, a node with no images cached using the VPC CNI will use around 500 MiB of images when in a <code>Ready</code> state with no other pods running on the node.</p>
<hr />
<h2 id="customizing-kubelet-config">Customizing Kubelet Config</h2>
<p>In some cases, customers may want to customize the <a href="https://kubernetes.io/docs/reference/config-api/kubelet-config.v1beta1/#kubelet-config-k8s-io-v1beta1-KubeletConfiguration">kubelet configuration</a> on their nodes, and there are two mechanisms to do that with the EKS Optimized AMI.</p>
<p><strong>Set the "--kubelet-extra-args" flag when invoking bootstrap.sh</strong></p>
<p><code>bootstrap.sh</code>, the script that bootstraps nodes when using the EKS Optimized AMI, supports a flag called <code>--kubelet-extra-args</code> that allows you to pass in additional <code>kubelet</code> configuration. If you invoke the bootstrap script yourself (self-managed nodegroups or EKS managed nodegroups with custom AMIs), you can use that to customize your configuration. For example, you can use something like the following in your userdata:</p>
<pre><code>/etc/eks/bootstrap.sh my-cluster --kubelet-extra-args '--registry-qps=20 --registry-burst=40'
</code></pre>
<p>In this case, it will set <code>registryPullQPS</code> to 20 and <code>registryBurst</code> to 40 in <code>kubelet</code>. Some of the flags, like the ones above, are marked as deprecated and you're encouraged to set them in the <code>kubelet</code> config file (described below), but they continue to work as of 1.23.</p>
<p><strong>Update the kubelet config file</strong></p>
<p>You can update the <code>kubelet</code> config file directly with new configuration. On EKS Optimized AMIs, the file is stored at <code>/etc/kubernetes/kubelet/kubelet-config.json</code>. It must be valid JSON. You can use a utility like <code>jq</code> (or your tool of choice) to edit the config in your user data:</p>
<pre><code>echo &quot;$(jq &quot;.registryPullQPS=20 | .registryBurst=40&quot; /etc/kubernetes/kubelet/kubelet-config.json)&quot; &gt; /etc/kubernetes/kubelet/kubelet-config.json
</code></pre>
<p>There are a couple of important caveats here:</p>
<ol>
<li>If you update the <code>kubelet</code> config file after <code>kubelet</code> has already started (i.e. <code>bootstrap.sh</code> already ran), you'll need to restart <code>kubelet</code> to pick up the latest configuration.</li>
<li><a href="https://github.com/awslabs/amazon-eks-ami/blob/main/templates/al2/runtime/bootstrap.sh">bootstrap.sh</a> does modify a few fields, like <code>kubeReserved</code> and <code>evictionHard</code>, so you'd need to modify the config after the bootstrap script is run and restart <code>kubelet</code> to overwrite those properties.</li>
</ol>
<p><strong>View active kubelet config</strong></p>
<p>When <code>kubelet</code> starts up, it logs all possible flags, including unset flags. The unset flags get logged with default values. <em>These logs do not necessarily reflect the actual active configuration.</em> This has caused confusion in the past when customers have configured the <code>kubelet</code> config file with one value and notice the default value is logged. Here is an example of the referenced log:</p>
<pre><code>Aug 16 21:53:49 ip-192-168-92-220.us-east-2.compute.internal kubelet[3935]: I0816 21:53:49.202824    3935 flags.go:59] FLAG: --registry-burst=&quot;10&quot;
Aug 16 21:53:49 ip-192-168-92-220.us-east-2.compute.internal kubelet[3935]: I0816 21:53:49.202829    3935 flags.go:59] FLAG: --registry-qps=&quot;5&quot;
</code></pre>
<p>To view the actual <code>kubelet</code> config on your node, you can use the Kubernetes API to confirm that your configuration has applied.</p>
<pre><code>$ kubectl proxy
$ curl -sSL &quot;http://localhost:8001/api/v1/nodes/ip-192-168-92-220.us-east-2.compute.internal/proxy/configz&quot; | jq

{
  &quot;kubeletconfig&quot;: {
    ...
    &quot;registryPullQPS&quot;: 20,
    &quot;registryBurst&quot;: 40,
    ...
  }
}
</code></pre>
<hr />
<h2 id="customizing-containerd-config">Customizing Containerd Config</h2>
<p>The EKS defaults for <code>containerd</code> will be written to <code>/etc/containerd/config.toml</code>.
Additional configuration files placed in the <code>/etc/containerd/config.d/</code> directory will be imported and override defaults as described in the <a href="https://github.com/containerd/containerd/blob/release/1.7/docs/man/containerd-config.toml.5.md"><code>containerd</code> documentation</a>.</p>
<blockquote>
<p><strong>NOTE</strong>: If you create an additional configuration file after <code>containerd</code>
has already started (i.e. <code>bootstrap.sh</code> has already executed), you'll need to
restart <code>containerd</code> to pick up the latest configuration.</p>
<p><strong>CAUTION</strong>: Making direct edits to the EKS default <code>containerd</code> configuration file is not recommended.</p>
</blockquote>
<p><strong>View active containerd config</strong></p>
<p>To see the final configuration that is produced and consumed by containerd, you
can use the containerd cli:</p>
<pre><code>$ containerd config dump
...
</code></pre>
<hr />
<h2 id="ephemeral-storage">Ephemeral Storage</h2>
<p>Some instance types launch with ephemeral NVMe instance storage (i3, i4i, c5d, c6id, etc). There are two main ways of utilizing this storage within Kubernetes: a single RAID-0 array for use by kubelet and containerd or mounting the individual disks for pod usage.</p>
<p>The EKS Optimized AMI includes a utility script to configure ephemeral storage. The script can be invoked by passing the <code>--local-disks &lt;raid0 | mount&gt;</code> flag to the <code>/etc/eks/bootstrap.sh</code> script or the script can be invoked directly at <code>/bin/setup-local-disks</code>. All disks are formatted with an XFS file system.</p>
<p>Below are details on the two disk setup options:</p>
<h3 id="raid-0-for-kubelet-and-containerd-raid0">RAID-0 for Kubelet and Containerd (raid0)</h3>
<p>A RAID-0 array is setup that includes all ephemeral NVMe instance storage disks. The containerd and kubelet state directories (<code>/var/lib/containerd</code> and <code>/var/lib/kubelet</code>) will then use the ephemeral storage for more and faster node ephemeral-storage. The node's ephemeral storage can be shared among pods that request ephemeral storage and container images that are downloaded to the node.</p>
<h3 id="mount-for-persistent-volumes-mount">Mount for Persistent Volumes (mount)</h3>
<p>Another way of utilizing the ephemeral disks is to format and mount the individual disks. Mounting individual disks allows the <a href="https://github.com/kubernetes-sigs/sig-storage-local-static-provisioner">local-static-provisioner</a> DaemonSet to create Persistent Volume Claims that pods can utilize.</p>
<h3 id="experimental-raid-10-kubelet-and-containerd-raid10">Experimental: RAID-10 Kubelet and Containerd (raid10)</h3>
<p>Similar to RAID-0 array, it is possible to utilize RAID-10 array for instance types with four or more ephemeral NVMe instance storage disks. RAID-10 tolerates failure of maximum of 2 disks. However, individual ephemeral disks can not be replaced, so the purpose of redundancy is to make graceful decommisioning of a node possible.</p>
<p>RAID-10 can be enabled by passing <code>--local-disks raid10</code> flag to the bootstrap script.</p>
<hr />
<h2 id="version-locked-packages">Version-locked packages</h2>
<p>Some packages are critical for correct, performant behavior of a Kubernetes node; such as:
- <code>kernel</code>
- <code>containerd</code>
- <code>runc</code></p>
<blockquote>
<p><strong>Note</strong>
This is not an exhaustive list. The complete list of locked packages is available with <code>yum versionlock list</code>.</p>
</blockquote>
<p>As a result, these packages should generally be modified within the bounds of a managed process that gracefully handles failures and prevents disruption to the cluster's workloads.</p>
<p>To prevent unintentional changes, the <a href="https://github.com/rpm-software-management/yum-utils/tree/05db7ef501fc9d6698935bcc039c83c0761c3be2/plugins/versionlock">yum-versionlock</a> plugin is used on these packages.</p>
<p>If you wish to modify a locked package, you can:</p>
<pre><code># unlock a single package
sudo yum versionlock delete $PACKAGE_NAME

# unlock all packages
sudo yum versionlock clear
</code></pre>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.sections"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>