# NOTE: we have the manage the add & remove lifecycle of the interface since we
# are not relying on ec2-net-utils. we also use a systemd-run call to avoid
# blocking the udev rule which can cause the execution to fail with a timeout.
#
# see: https://github.com/amazonlinux/amazon-ec2-net-utils/blob/3261b3b4c8824343706ee54d4a6f5d05cd8a5979/udev/99-vpc-policy-routes.rules#L2O
SUBSYSTEM=="net", ACTION=="add", ENV{ID_NET_DRIVER}=="vif|ena|ixgbevf", RUN+="/usr/bin/systemd-run --no-block /usr/bin/nodeadm-internal udev-net-manager --action add --interface $name"
SUBSYSTEM=="net", ACTION=="remove", ENV{ID_NET_DRIVER}=="vif|ena|ixgbevf", RUN+="/usr/bin/systemd-run --no-block /usr/bin/nodeadm-internal udev-net-manager --action remove --interface $name"
